
drop table if exists append_updates;
create table append_updates as
select *
from update_table ut
where not exists(
    select *
    from all_coins ac
    where ac.ticker = ut.ticker and
        ac.time = ut.time
);

update all_coins t
set AdrActCnt = coalesce(ut.AdrActCnt, t.AdrActCnt),
    AdrBal1in100KCnt = coalesce(ut.AdrBal1in100KCnt, t.AdrBal1in100KCnt),
    AdrBal1in100MCnt = coalesce(ut.AdrBal1in100MCnt, t.AdrBal1in100MCnt),
    AdrBal1in10BCnt = coalesce(ut.AdrBal1in10BCnt, t.AdrBal1in10BCnt),
    AdrBal1in10KCnt = coalesce(ut.AdrBal1in10KCnt, t.AdrBal1in10KCnt),
    AdrBal1in10MCnt = coalesce(ut.AdrBal1in10MCnt, t.AdrBal1in10MCnt),
    AdrBal1in1BCnt = coalesce(ut.AdrBal1in1BCnt, t.AdrBal1in1BCnt),
    AdrBal1in1KCnt = coalesce(ut.AdrBal1in1KCnt, t.AdrBal1in1KCnt),
    AdrBal1in1MCnt = coalesce(ut.AdrBal1in1MCnt, t.AdrBal1in1MCnt),
    AdrBalCnt = coalesce(ut.AdrBalCnt, t.AdrBalCnt),
    "AdrBalNtv0.001Cnt" = coalesce(ut."AdrBalNtv0.001Cnt", t."AdrBalNtv0.001Cnt"),
    "AdrBalNtv0.01Cnt" = coalesce(ut."AdrBalNtv0.01Cnt", t."AdrBalNtv0.01Cnt"),
    "AdrBalNtv0.1Cnt" = coalesce(ut."AdrBalNtv0.1Cnt", t."AdrBalNtv0.1Cnt"),
    AdrBalNtv100Cnt = coalesce(ut.AdrBalNtv100Cnt, t.AdrBalNtv100Cnt),
    AdrBalNtv100KCnt = coalesce(ut.AdrBalNtv100KCnt, t.AdrBalNtv100KCnt),
    AdrBalNtv10Cnt = coalesce(ut.AdrBalNtv10Cnt, t.AdrBalNtv10Cnt),
    AdrBalNtv10KCnt = coalesce(ut.AdrBalNtv10KCnt, t.AdrBalNtv10KCnt),
    AdrBalNtv1Cnt = coalesce(ut.AdrBalNtv1Cnt, t.AdrBalNtv1Cnt),
    AdrBalNtv1KCnt = coalesce(ut.AdrBalNtv1KCnt, t.AdrBalNtv1KCnt),
    AdrBalNtv1MCnt = coalesce(ut.AdrBalNtv1MCnt, t.AdrBalNtv1MCnt),
    AdrBalUSD100Cnt = coalesce(ut.AdrBalUSD100Cnt, t.AdrBalUSD100Cnt),
    AdrBalUSD100KCnt = coalesce(ut.AdrBalUSD100KCnt, t.AdrBalUSD100KCnt),
    AdrBalUSD10Cnt = coalesce(ut.AdrBalUSD10Cnt, t.AdrBalUSD10Cnt),
    AdrBalUSD10KCnt = coalesce(ut.AdrBalUSD10KCnt, t.AdrBalUSD10KCnt),
    AdrBalUSD10MCnt = coalesce(ut.AdrBalUSD10MCnt, t.AdrBalUSD10MCnt),
    AdrBalUSD1Cnt = coalesce(ut.AdrBalUSD1Cnt, t.AdrBalUSD1Cnt),
    AdrBalUSD1KCnt = coalesce(ut.AdrBalUSD1KCnt, t.AdrBalUSD1KCnt),
    AdrBalUSD1MCnt = coalesce(ut.AdrBalUSD1MCnt, t.AdrBalUSD1MCnt),
    AssetCompletionTime = coalesce(ut.AssetCompletionTime, t.AssetCompletionTime),
    AssetEODCompletionTime = coalesce(ut.AssetEODCompletionTime, t.AssetEODCompletionTime),
    BlkCnt = coalesce(ut.BlkCnt, t.BlkCnt),
    BlkSizeMeanByte = coalesce(ut.BlkSizeMeanByte, t.BlkSizeMeanByte),
    BlkWghtMean = coalesce(ut.BlkWghtMean, t.BlkWghtMean),
    BlkWghtTot = coalesce(ut.BlkWghtTot, t.BlkWghtTot),
    CapAct1yrUSD = coalesce(ut.CapAct1yrUSD, t.CapAct1yrUSD),
    CapMVRVCur = coalesce(ut.CapMVRVCur, t.CapMVRVCur),
    CapMVRVFF = coalesce(ut.CapMVRVFF, t.CapMVRVFF),
    CapMrktCurUSD = coalesce(ut.CapMrktCurUSD, t.CapMrktCurUSD),
    CapMrktEstUSD = coalesce(ut.CapMrktEstUSD, t.CapMrktEstUSD),
    CapMrktFFUSD = coalesce(ut.CapMrktFFUSD, t.CapMrktFFUSD),
    CapRealUSD = coalesce(ut.CapRealUSD, t.CapRealUSD),
    DiffLast = coalesce(ut.DiffLast, t.DiffLast),
    DiffMean = coalesce(ut.DiffMean, t.DiffMean),
    FeeByteMeanNtv = coalesce(ut.FeeByteMeanNtv, t.FeeByteMeanNtv),
    FeeMeanNtv = coalesce(ut.FeeMeanNtv, t.FeeMeanNtv),
    FeeMeanUSD = coalesce(ut.FeeMeanUSD, t.FeeMeanUSD),
    FeeMedNtv = coalesce(ut.FeeMedNtv, t.FeeMedNtv),
    FeeMedUSD = coalesce(ut.FeeMedUSD, t.FeeMedUSD),
    FeeTotNtv = coalesce(ut.FeeTotNtv, t.FeeTotNtv),
    FeeTotUSD = coalesce(ut.FeeTotUSD, t.FeeTotUSD),
    FlowInExNtv = coalesce(ut.FlowInExNtv, t.FlowInExNtv),
    FlowInExUSD = coalesce(ut.FlowInExUSD, t.FlowInExUSD),
    FlowOutExNtv = coalesce(ut.FlowOutExNtv, t.FlowOutExNtv),
    FlowOutExUSD = coalesce(ut.FlowOutExUSD, t.FlowOutExUSD),
    FlowTfrFromExCnt = coalesce(ut.FlowTfrFromExCnt, t.FlowTfrFromExCnt),
    HashRate = coalesce(ut.HashRate, t.HashRate),
    HashRate30d = coalesce(ut.HashRate30d, t.HashRate30d),
    IssContNtv = coalesce(ut.IssContNtv, t.IssContNtv),
    IssContPctAnn = coalesce(ut.IssContPctAnn, t.IssContPctAnn),
    IssContPctDay = coalesce(ut.IssContPctDay, t.IssContPctDay),
    IssContUSD = coalesce(ut.IssContUSD, t.IssContUSD),
    IssTotNtv = coalesce(ut.IssTotNtv, t.IssTotNtv),
    IssTotUSD = coalesce(ut.IssTotUSD, t.IssTotUSD),
    NDF = coalesce(ut.NDF, t.NDF),
    NVTAdj = coalesce(ut.NVTAdj, t.NVTAdj),
    NVTAdj90 = coalesce(ut.NVTAdj90, t.NVTAdj90),
    NVTAdjFF = coalesce(ut.NVTAdjFF, t.NVTAdjFF),
    NVTAdjFF90 = coalesce(ut.NVTAdjFF90, t.NVTAdjFF90),
    PriceBTC = coalesce(ut.PriceBTC, t.PriceBTC),
    PriceUSD = coalesce(ut.PriceUSD, t.PriceUSD),
    ROI1yr = coalesce(ut.ROI1yr, t.ROI1yr),
    ROI30d = coalesce(ut.ROI30d, t.ROI30d),
    ReferenceRate = coalesce(ut.ReferenceRate, t.ReferenceRate),
    ReferenceRateBTC = coalesce(ut.ReferenceRateBTC, t.ReferenceRateBTC),
    ReferenceRateETH = coalesce(ut.ReferenceRateETH, t.ReferenceRateETH),
    ReferenceRateEUR = coalesce(ut.ReferenceRateEUR, t.ReferenceRateEUR),
    ReferenceRateUSD = coalesce(ut.ReferenceRateUSD, t.ReferenceRateUSD),
    RevAllTimeUSD = coalesce(ut.RevAllTimeUSD, t.RevAllTimeUSD),
    RevHashNtv = coalesce(ut.RevHashNtv, t.RevHashNtv),
    RevHashRateNtv = coalesce(ut.RevHashRateNtv, t.RevHashRateNtv),
    RevHashRateUSD = coalesce(ut.RevHashRateUSD, t.RevHashRateUSD),
    RevHashUSD = coalesce(ut.RevHashUSD, t.RevHashUSD),
    RevNtv = coalesce(ut.RevNtv, t.RevNtv),
    RevUSD = coalesce(ut.RevUSD, t.RevUSD),
    SER = coalesce(ut.SER, t.SER),
    SplyAct10yr = coalesce(ut.SplyAct10yr, t.SplyAct10yr),
    SplyAct180d = coalesce(ut.SplyAct180d, t.SplyAct180d),
    SplyAct1d = coalesce(ut.SplyAct1d, t.SplyAct1d),
    SplyAct1yr = coalesce(ut.SplyAct1yr, t.SplyAct1yr),
    SplyAct2yr = coalesce(ut.SplyAct2yr, t.SplyAct2yr),
    SplyAct30d = coalesce(ut.SplyAct30d, t.SplyAct30d),
    SplyAct3yr = coalesce(ut.SplyAct3yr, t.SplyAct3yr),
    SplyAct4yr = coalesce(ut.SplyAct4yr, t.SplyAct4yr),
    SplyAct5yr = coalesce(ut.SplyAct5yr, t.SplyAct5yr),
    SplyAct7d = coalesce(ut.SplyAct7d, t.SplyAct7d),
    SplyAct90d = coalesce(ut.SplyAct90d, t.SplyAct90d),
    SplyActEver = coalesce(ut.SplyActEver, t.SplyActEver),
    SplyActPct1yr = coalesce(ut.SplyActPct1yr, t.SplyActPct1yr),
    SplyAdrBal1in100K = coalesce(ut.SplyAdrBal1in100K, t.SplyAdrBal1in100K),
    SplyAdrBal1in100M = coalesce(ut.SplyAdrBal1in100M, t.SplyAdrBal1in100M),
    SplyAdrBal1in10B = coalesce(ut.SplyAdrBal1in10B, t.SplyAdrBal1in10B),
    SplyAdrBal1in10K = coalesce(ut.SplyAdrBal1in10K, t.SplyAdrBal1in10K),
    SplyAdrBal1in10M = coalesce(ut.SplyAdrBal1in10M, t.SplyAdrBal1in10M),
    SplyAdrBal1in1B = coalesce(ut.SplyAdrBal1in1B, t.SplyAdrBal1in1B),
    SplyAdrBal1in1K = coalesce(ut.SplyAdrBal1in1K, t.SplyAdrBal1in1K),
    SplyAdrBal1in1M = coalesce(ut.SplyAdrBal1in1M, t.SplyAdrBal1in1M),
    "SplyAdrBalNtv0.001" = coalesce(ut."SplyAdrBalNtv0.001", t."SplyAdrBalNtv0.001"),
    "SplyAdrBalNtv0.01" = coalesce(ut."SplyAdrBalNtv0.01", t."SplyAdrBalNtv0.01"),
    "SplyAdrBalNtv0.1" = coalesce(ut."SplyAdrBalNtv0.1", t."SplyAdrBalNtv0.1"),
    SplyAdrBalNtv1 = coalesce(ut.SplyAdrBalNtv1, t.SplyAdrBalNtv1),
    SplyAdrBalNtv10 = coalesce(ut.SplyAdrBalNtv10, t.SplyAdrBalNtv10),
    SplyAdrBalNtv100 = coalesce(ut.SplyAdrBalNtv100, t.SplyAdrBalNtv100),
    SplyAdrBalNtv100K = coalesce(ut.SplyAdrBalNtv100K, t.SplyAdrBalNtv100K),
    SplyAdrBalNtv10K = coalesce(ut.SplyAdrBalNtv10K, t.SplyAdrBalNtv10K),
    SplyAdrBalNtv1K = coalesce(ut.SplyAdrBalNtv1K, t.SplyAdrBalNtv1K),
    SplyAdrBalNtv1M = coalesce(ut.SplyAdrBalNtv1M, t.SplyAdrBalNtv1M),
    SplyAdrBalUSD1 = coalesce(ut.SplyAdrBalUSD1, t.SplyAdrBalUSD1),
    SplyAdrBalUSD10 = coalesce(ut.SplyAdrBalUSD10, t.SplyAdrBalUSD10),
    SplyAdrBalUSD100 = coalesce(ut.SplyAdrBalUSD100, t.SplyAdrBalUSD100),
    SplyAdrBalUSD100K = coalesce(ut.SplyAdrBalUSD100K, t.SplyAdrBalUSD100K),
    SplyAdrBalUSD10K = coalesce(ut.SplyAdrBalUSD10K, t.SplyAdrBalUSD10K),
    SplyAdrBalUSD10M = coalesce(ut.SplyAdrBalUSD10M, t.SplyAdrBalUSD10M),
    SplyAdrBalUSD1K = coalesce(ut.SplyAdrBalUSD1K, t.SplyAdrBalUSD1K),
    SplyAdrBalUSD1M = coalesce(ut.SplyAdrBalUSD1M, t.SplyAdrBalUSD1M),
    SplyAdrTop100 = coalesce(ut.SplyAdrTop100, t.SplyAdrTop100),
    SplyAdrTop10Pct = coalesce(ut.SplyAdrTop10Pct, t.SplyAdrTop10Pct),
    SplyAdrTop1Pct = coalesce(ut.SplyAdrTop1Pct, t.SplyAdrTop1Pct),
    SplyCur = coalesce(ut.SplyCur, t.SplyCur),
    SplyExpFut10yr = coalesce(ut.SplyExpFut10yr, t.SplyExpFut10yr),
    SplyFF = coalesce(ut.SplyFF, t.SplyFF),
    SplyMiner0HopAllNtv = coalesce(ut.SplyMiner0HopAllNtv, t.SplyMiner0HopAllNtv),
    SplyMiner0HopAllUSD = coalesce(ut.SplyMiner0HopAllUSD, t.SplyMiner0HopAllUSD),
    SplyMiner1HopAllNtv = coalesce(ut.SplyMiner1HopAllNtv, t.SplyMiner1HopAllNtv),
    SplyMiner1HopAllUSD = coalesce(ut.SplyMiner1HopAllUSD, t.SplyMiner1HopAllUSD),
    TxCnt = coalesce(ut.TxCnt, t.TxCnt),
    TxCntSec = coalesce(ut.TxCntSec, t.TxCntSec),
    TxTfrCnt = coalesce(ut.TxTfrCnt, t.TxTfrCnt),
    TxTfrValAdjNtv = coalesce(ut.TxTfrValAdjNtv, t.TxTfrValAdjNtv),
    TxTfrValAdjUSD = coalesce(ut.TxTfrValAdjUSD, t.TxTfrValAdjUSD),
    TxTfrValMeanNtv = coalesce(ut.TxTfrValMeanNtv, t.TxTfrValMeanNtv),
    TxTfrValMeanUSD = coalesce(ut.TxTfrValMeanUSD, t.TxTfrValMeanUSD),
    TxTfrValMedNtv = coalesce(ut.TxTfrValMedNtv, t.TxTfrValMedNtv),
    TxTfrValMedUSD = coalesce(ut.TxTfrValMedUSD, t.TxTfrValMedUSD),
    VelCur1yr = coalesce(ut.VelCur1yr, t.VelCur1yr),
    VtyDayRet180d = coalesce(ut.VtyDayRet180d, t.VtyDayRet180d),
    VtyDayRet30d = coalesce(ut.VtyDayRet30d, t.VtyDayRet30d),
    "principal_market_price_usd" = coalesce(ut."principal_market_price_usd", t."principal_market_price_usd"),
    "principal_market_usd" = coalesce(ut."principal_market_usd", t."principal_market_usd")
from update_table ut
where ut.ticker = t.ticker and ut.time = t.time;

insert into all_coins (select * from append_updates);